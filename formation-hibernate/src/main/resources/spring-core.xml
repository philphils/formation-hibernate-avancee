<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:tx="http://www.springframework.org/schema/tx"
	xmlns:jpa="http://www.springframework.org/schema/data/jpa"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd
        http://www.springframework.org/schema/tx 
        http://www.springframework.org/schema/tx/spring-tx.xsd
        http://www.springframework.org/schema/data/jpa
        http://www.springframework.org/schema/data/jpa/spring-jpa.xsd">

	<context:component-scan
		base-package="fr.insee.formation.hibernate" />

	<context:property-placeholder
		location="classpath:env.properties" />

	<beans>

		<bean id="myEmf"
			class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean">

			<property name="jpaVendorAdapter">
				<bean
					class="org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter" />
			</property>

			<property name="dataSource" ref="dataSource" />

			<property name="jpaProperties">
				<props>
					<prop key="hibernate.default_schema">${fr.insee.formation.hibernate.schema}</prop>

					<!-- generate ddl -->
					<prop
						key="javax.persistence.schema-generation.database.action">drop-and-create</prop>
					<prop key="hibernate.query.substitutions">true 1, false 0 </prop>

					<!-- dialect -->
					<prop key="hibernate.dialect">org.hibernate.dialect.PostgreSQLDialect</prop>
					<prop key="hibernate.connection.useUnicode">true</prop>
					<prop key="hibernate.connection.charSet">UTF-8</prop>

					<!-- logging debug information -->
					<prop key="hibernate.show_sql">true</prop>
					<prop key="hibernate.format_sql">true</prop>

					<!-- Java Persistence properties -->
					<prop key="javax.persistence.schema-generation.scripts.action">drop-and-create</prop>
					<prop
						key="javax.persistence.schema-generation.scripts.create-target">script-create.ddl</prop>
					<prop
						key="javax.persistence.schema-generation.scripts.drop-target">script-drop.ddl</prop>
					<prop key="hibernate.hbm2ddl.delimiter">;</prop>

				</props>
			</property>

		</bean>

		<bean id="transactionManager"
			class="org.springframework.orm.jpa.JpaTransactionManager">
			<property name="entityManagerFactory" ref="myEmf" />
		</bean>

		<!-- Bean pour pouvoir utilsier une transaction dans les test unitaires -->
		<bean
			class="org.springframework.transaction.support.TransactionTemplate">
			<constructor-arg ref="transactionManager" />
		</bean>

		<tx:annotation-driven
			transaction-manager="transactionManager" />

		<jpa:repositories
			base-package="fr.insee.formation.hibernate.repositories" />



	</beans>

</beans>